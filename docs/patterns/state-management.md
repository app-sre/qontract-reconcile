# State Management

Some integrations need to persist data between runs. For example, an integration might need to keep track of the unique IDs of resources it creates in an external system. `qontract-reconcile` provides a simple state management framework for this purpose.

**How it Works:**

The state is stored in an S3 bucket, which is configured via the `APP_INTERFACE_STATE_BUCKET_ACCOUNT` environment variable in `app-interface`. The `reconcile.utils.state.State` class provides a simple key-value interface for integrations to interact with this storage.

**Example (`statuspage` integration):**

The `statuspage` integration needs to map the component names defined in `app-interface` to the unique component IDs generated by the StatusPage.io API.

```python
# from reconcile.statuspage.state import S3ComponentBindingState

# The state object is initialized for a specific integration
state = State(
    integration=f"{QONTRACT_INTEGRATION}.{page_id}",
    accounts=aws_accounts,
    settings=settings,
)

# The integration can then store and retrieve mappings
binding_state = S3ComponentBindingState(state)
component_id = binding_state.get_id_for_component_name("My Component")
if not component_id:
    # create component and store its ID
    new_id = create_component_in_api()
    binding_state.bind_component("My Component", new_id)
```

This allows the integration to remember the link between the `app-interface` name and the external provider's ID across multiple runs.
