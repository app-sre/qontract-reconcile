builders:
- shell: "# A common pattern is for people to log in Quay storing creds in the .docker/config.json\n\
    # This leads to credentials being added to the image if the Dockerfile contains\
    \ an\n# ADD . . or COPY . . statement. This block will try to mitigate it if the\
    \ common pattern\n# is used. We will also ignore the .dockerignore file if it\
    \ doesn't exist and we create it,\n# it's nicer.\n[ -f .dockerignore ] || echo\
    \ \".dockerignore\" > .dockerignore\necho \".docker/*\" >> .dockerignore\n\n#\
    \ Ignore changes in .dockerignore in case it is tracked. The case that it is not\
    \ tracked and\n# we create it is covered via a global .gitignore for the jenkins\
    \ user.\ngit ls-files .dockerignore | grep -q .dockerignore && git update-index\
    \ --assume-unchanged .dockerignore\n\n# Set Custom auth paths for both Podman\
    \ and Docker.\n# BUILD_TAG String of \"jenkins-${JOB_NAME}-${BUILD_NUMBER}\".\n\
    # All forward slashes (\"/\") in the JOB_NAME are replaced with dashes (\"-\"\
    ).\nexport DOCKER_CONFIG=/tmp/${BUILD_TAG}\nexport REGISTRY_AUTH_FILE=/tmp/${BUILD_TAG}/auth.json\n\
    mkdir -p \"$DOCKER_CONFIG\"\n[ -f /var/lib/jenkins/.docker/config.json ] && cp\
    \ /var/lib/jenkins/.docker/config.json \"$REGISTRY_AUTH_FILE\"\n\n# continue with\
    \ job's build script\n./build_deploy.sh\n\nexport BUILD_DEPLOY_EXIT_CODE=$?\n\n\
    # Remove custom podman/docker auth locations\nif [[ \"/tmp/${BUILD_TAG}\" != \"\
    /tmp/\" ]]; then\n  rm -rf /tmp/${BUILD_TAG}\nfi\n\nif [ $BUILD_DEPLOY_EXIT_CODE\
    \ -ne 0 ]; then\n  echo \"build_deploy_script failed, exiting.\"\n  exit 1\nfi\n"
description: '[rhel8] acs-ui build-master

  Managed by App-Interface https://gitlab.cee.redhat.com/service/app-interface

  <!-- Managed by Jenkins Job Builder -->'
disabled: 'false'
display-name: '[rhel8] acs-ui build-master'
name: RedHatInsights-acs-ui-gh-build-main
node: rhel8
properties:
- github:
    url: https://github.com/RedHatInsights/acs-ui/
- naginator-opt-out:
    opt-out: true
publishers:
- slack:
    notify-failure: true
    notify-repeated-failure: true
    notify-start: false
    notify-success: false
    room: consoledot-development-fails
- naginator:
    max-failed-builds: 3
scm:
- git:
    branches:
    - main
    credentials-id: fa45620b-6675-49d5-8a86-eb19e5fafe4c
    url: git@github.com:RedHatInsights/acs-ui.git
triggers:
- github
wrappers:
- timeout_wrapper:
    timeout: 30
- ansicolor
- vault-secrets:
    credentials-id: vault-creds-ci-ext
    name: vault_defaults
    secrets:
    - name: quay_api_token
      secret-path: insights-cicd/quay/cloudservices
      secret-values:
      - env-var: QUAY_API_TOKEN
        vault-key: api-token
    vault-url: https://vault.ci.ext.devshift.net
